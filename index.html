<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«å½±æ­¦å£«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461, #1e3799, #4a69bd);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .game-container {
            max-width: 900px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .game-header {
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 2px solid #e74c3c;
        }
        
        .game-header h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #e74c3c;
            text-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }
        
        .game-header p {
            color: #ddd;
            font-size: 16px;
        }
        
        .game-content {
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }
        
        .screen {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .active {
            display: block;
        }
        
        /* å¼€å§‹å±å¹• */
        .start-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .start-screen h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #f1c40f;
        }
        
        .start-screen p {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #ddd;
        }
        
        .character-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .character {
            width: 150px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .character:hover {
            transform: translateY(-5px);
            border-color: #f1c40f;
        }
        
        .character.selected {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.2);
        }
        
        .character-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .character-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .character-desc {
            font-size: 14px;
            color: #aaa;
        }
        
        /* æˆ˜æ–—å±å¹• */
        .battle-screen {
            padding: 20px;
        }
        
        .battle-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
        }
        
        .player-info, .enemy-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: #2ecc71;
            transition: width 0.5s;
        }
        
        .player-health .health-fill {
            background: linear-gradient(to right, #2ecc71, #27ae60);
        }
        
        .enemy-health .health-fill {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }
        
        .chakra-bar {
            width: 200px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .chakra-fill {
            height: 100%;
            background: #3498db;
            transition: width 0.5s;
        }
        
        .battle-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 250px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }
        
        .player-character, .enemy-character {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .character-avatar {
            font-size: 80px;
            transition: all 0.3s;
        }
        
        .player-character .character-avatar {
            transform: scaleX(-1);
        }
        
        .battle-log {
            height: 100px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 10px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .battle-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .action-btn {
            padding: 15px;
            background: rgba(52, 152, 219, 0.7);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .action-btn:hover {
            background: rgba(52, 152, 219, 0.9);
            transform: translateY(-3px);
        }
        
        .action-btn:disabled {
            background: rgba(127, 140, 141, 0.5);
            cursor: not-allowed;
            transform: none;
        }
        
        .action-cost {
            font-size: 12px;
            color: #f1c40f;
        }
        
        /* ç»“æŸå±å¹• */
        .end-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .end-screen h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: #f1c40f;
        }
        
        .end-screen p {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 12px 30px;
            background: #e74c3c;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }
        
        .btn:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes attack {
            0% { transform: translateX(0); }
            50% { transform: translateX(50px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes enemyAttack {
            0% { transform: translateX(0); }
            50% { transform: translateX(-50px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes damage {
            0% { color: white; }
            50% { color: #e74c3c; transform: scale(1.2); }
            100% { color: white; }
        }
        
        @keyframes jutsu {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        .attack-animation {
            animation: attack 0.5s;
        }
        
        .enemy-attack-animation {
            animation: enemyAttack 0.5s;
        }
        
        .damage-animation {
            animation: damage 0.5s;
        }
        
        .jutsu-animation {
            position: absolute;
            font-size: 40px;
            animation: jutsu 1s forwards;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .character-selection {
                flex-direction: column;
                align-items: center;
            }
            
            .battle-actions {
                grid-template-columns: 1fr;
            }
            
            .health-bar, .chakra-bar {
                width: 150px;
            }
            
            .character-avatar {
                font-size: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ç«å½±æ­¦å£«</h1>
            <p>é€‰æ‹©ä½ çš„å¿è€…ï¼ŒæŒæ¡å¿æœ¯ï¼Œæˆä¸ºç«å½±ï¼</p>
        </div>
        
        <div class="game-content">
            <!-- å¼€å§‹å±å¹• -->
            <div id="startScreen" class="screen active">
                <div class="start-screen">
                    <h2>æ¬¢è¿æ¥åˆ°ç«å½±æ­¦å£«çš„ä¸–ç•Œ</h2>
                    <p>åœ¨å¿è€…ä¸–ç•Œä¸­ï¼Œä½ å°†é¢å¯¹å¼ºå¤§çš„æ•Œäººã€‚é€‰æ‹©ä½ çš„å¿è€…ï¼Œå­¦ä¹ å¼ºå¤§çš„å¿æœ¯ï¼Œå‡»è´¥æ‰€æœ‰æ•Œäººï¼Œæˆä¸ºç«å½±ï¼</p>
                    
                    <div class="character-selection">
                        <div class="character" data-character="naruto">
                            <div class="character-icon">ğŸ”¥</div>
                            <div class="character-name">æ¼©æ¶¡é¸£äºº</div>
                            <div class="character-desc">æ“…é•¿å½±åˆ†èº«å’Œèºæ—‹ä¸¸ï¼Œæ‹¥æœ‰ä¹å°¾æŸ¥å…‹æ‹‰</div>
                        </div>
                        <div class="character" data-character="sasuke">
                            <div class="character-icon">âš¡</div>
                            <div class="character-name">å®‡æ™ºæ³¢ä½åŠ©</div>
                            <div class="character-desc">æ“…é•¿ç«éå’Œå†™è½®çœ¼ï¼Œæ‹¥æœ‰å¼ºå¤§çš„ç³æœ¯</div>
                        </div>
                        <div class="character" data-character="sakura">
                            <div class="character-icon">ğŸŒ¸</div>
                            <div class="character-name">æ˜¥é‡æ¨±</div>
                            <div class="character-desc">æ“…é•¿åŒ»ç–—å¿æœ¯å’Œæ€ªåŠ›ï¼Œæ‹¥æœ‰ç²¾å‡†çš„æŸ¥å…‹æ‹‰æ§åˆ¶</div>
                        </div>
                    </div>
                    
                    <button id="startBtn" class="btn">å¼€å§‹æ¸¸æˆ</button>
                </div>
            </div>
            
            <!-- æˆ˜æ–—å±å¹• -->
            <div id="battleScreen" class="screen">
                <div class="battle-screen">
                    <div class="battle-info">
                        <div class="player-info">
                            <div id="playerName" class="character-name">æ¼©æ¶¡é¸£äºº</div>
                            <div class="player-health health-bar">
                                <div id="playerHealth" class="health-fill" style="width: 100%"></div>
                            </div>
                            <div class="chakra-bar">
                                <div id="playerChakra" class="chakra-fill" style="width: 100%"></div>
                            </div>
                        </div>
                        <div class="enemy-info">
                            <div id="enemyName" class="character-name">æ•Œäºº</div>
                            <div class="enemy-health health-bar">
                                <div id="enemyHealth" class="health-fill" style="width: 100%"></div>
                            </div>
                            <div class="chakra-bar">
                                <div id="enemyChakra" class="chakra-fill" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="battle-area">
                        <div class="player-character">
                            <div id="playerAvatar" class="character-avatar">ğŸ”¥</div>
                            <div id="playerLevel" class="character-level">Lv. 1</div>
                        </div>
                        <div class="enemy-character">
                            <div id="enemyAvatar" class="character-avatar">ğŸ’€</div>
                            <div id="enemyLevel" class="character-level">Lv. 1</div>
                        </div>
                    </div>
                    
                    <div id="battleLog" class="battle-log">
                        <div>æˆ˜æ–—å¼€å§‹ï¼</div>
                    </div>
                    
                    <div class="battle-actions">
                        <button class="action-btn" data-action="attack">
                            <span>ä½“æœ¯æ”»å‡»</span>
                            <span class="action-cost">æ¶ˆè€—: 0 æŸ¥å…‹æ‹‰</span>
                        </button>
                        <button class="action-btn" data-action="jutsu1">
                            <span id="jutsu1Name">èºæ—‹ä¸¸</span>
                            <span class="action-cost" id="jutsu1Cost">æ¶ˆè€—: 30 æŸ¥å…‹æ‹‰</span>
                        </button>
                        <button class="action-btn" data-action="jutsu2">
                            <span id="jutsu2Name">å½±åˆ†èº«</span>
                            <span class="action-cost" id="jutsu2Cost">æ¶ˆè€—: 20 æŸ¥å…‹æ‹‰</span>
                        </button>
                        <button class="action-btn" data-action="heal">
                            <span>åŒ»ç–—å¿æœ¯</span>
                            <span class="action-cost">æ¶ˆè€—: 25 æŸ¥å…‹æ‹‰</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ç»“æŸå±å¹• -->
            <div id="endScreen" class="screen">
                <div class="end-screen">
                    <h2 id="endTitle">æ¸¸æˆç»“æŸ</h2>
                    <p id="endMessage">ä½ å·²ç»å‡»è´¥äº†æ‰€æœ‰æ•Œäººï¼Œæˆä¸ºäº†ç«å½±ï¼</p>
                    <button id="restartBtn" class="btn">é‡æ–°å¼€å§‹</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            characters: {
                naruto: {
                    name: "æ¼©æ¶¡é¸£äºº",
                    avatar: "ğŸ”¥",
                    health: 100,
                    maxHealth: 100,
                    chakra: 100,
                    maxChakra: 100,
                    level: 1,
                    jutsu1: { name: "èºæ—‹ä¸¸", cost: 30, damage: 40 },
                    jutsu2: { name: "å½±åˆ†èº«", cost: 20, effect: "dodge" }
                },
                sasuke: {
                    name: "å®‡æ™ºæ³¢ä½åŠ©",
                    avatar: "âš¡",
                    health: 90,
                    maxHealth: 90,
                    chakra: 110,
                    maxChakra: 110,
                    level: 1,
                    jutsu1: { name: "åƒé¸Ÿ", cost: 35, damage: 45 },
                    jutsu2: { name: "å†™è½®çœ¼", cost: 25, effect: "critical" }
                },
                sakura: {
                    name: "æ˜¥é‡æ¨±",
                    avatar: "ğŸŒ¸",
                    health: 120,
                    maxHealth: 120,
                    chakra: 90,
                    maxChakra: 90,
                    level: 1,
                    jutsu1: { name: "æ€ªåŠ›", cost: 20, damage: 30 },
                    jutsu2: { name: "åŒ»ç–—å¿æœ¯", cost: 25, effect: "heal" }
                }
            },
            enemies: [
                {
                    name: "ä¸‹å¿",
                    avatar: "ğŸ’€",
                    health: 50,
                    maxHealth: 50,
                    chakra: 50,
                    maxChakra: 50,
                    level: 1,
                    damage: 10
                },
                {
                    name: "ä¸­å¿",
                    avatar: "ğŸ‘º",
                    health: 80,
                    maxHealth: 80,
                    chakra: 70,
                    maxChakra: 70,
                    level: 2,
                    damage: 15
                },
                {
                    name: "ä¸Šå¿",
                    avatar: "ğŸ˜ˆ",
                    health: 120,
                    maxHealth: 120,
                    chakra: 100,
                    maxChakra: 100,
                    level: 3,
                    damage: 25
                },
                {
                    name: "å½±çº§å¿è€…",
                    avatar: "ğŸ‘¹",
                    health: 150,
                    maxHealth: 150,
                    chakra: 120,
                    maxChakra: 120,
                    level: 4,
                    damage: 35
                }
            ],
            currentEnemyIndex: 0,
            player: null,
            enemy: null,
            battleLog: [],
            dodgeNextAttack: false,
            criticalNextAttack: false
        };

        // DOMå…ƒç´ 
        const startScreen = document.getElementById('startScreen');
        const battleScreen = document.getElementById('battleScreen');
        const endScreen = document.getElementById('endScreen');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const characterElements = document.querySelectorAll('.character');
        const playerNameElement = document.getElementById('playerName');
        const playerHealthElement = document.getElementById('playerHealth');
        const playerChakraElement = document.getElementById('playerChakra');
        const playerAvatarElement = document.getElementById('playerAvatar');
        const playerLevelElement = document.getElementById('playerLevel');
        const enemyNameElement = document.getElementById('enemyName');
        const enemyHealthElement = document.getElementById('enemyHealth');
        const enemyChakraElement = document.getElementById('enemyChakra');
        const enemyAvatarElement = document.getElementById('enemyAvatar');
        const enemyLevelElement = document.getElementById('enemyLevel');
        const battleLogElement = document.getElementById('battleLog');
        const actionButtons = document.querySelectorAll('.action-btn');
        const jutsu1NameElement = document.getElementById('jutsu1Name');
        const jutsu1CostElement = document.getElementById('jutsu1Cost');
        const jutsu2NameElement = document.getElementById('jutsu2Name');
        const jutsu2CostElement = document.getElementById('jutsu2Cost');
        const endTitleElement = document.getElementById('endTitle');
        const endMessageElement = document.getElementById('endMessage');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // è§’è‰²é€‰æ‹©
            let selectedCharacter = null;
            
            characterElements.forEach(char => {
                char.addEventListener('click', () => {
                    characterElements.forEach(c => c.classList.remove('selected'));
                    char.classList.add('selected');
                    selectedCharacter = char.dataset.character;
                });
            });
            
            // å¼€å§‹æ¸¸æˆæŒ‰é’®
            startBtn.addEventListener('click', () => {
                if (!selectedCharacter) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²ï¼');
                    return;
                }
                
                gameData.player = {...gameData.characters[selectedCharacter]};
                startBattle();
            });
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            restartBtn.addEventListener('click', () => {
                gameData.currentEnemyIndex = 0;
                showScreen(startScreen);
            });
            
            // æˆ˜æ–—åŠ¨ä½œæŒ‰é’®
            actionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const action = btn.dataset.action;
                    performPlayerAction(action);
                });
            });
        }

        // å¼€å§‹æˆ˜æ–—
        function startBattle() {
            gameData.enemy = {...gameData.enemies[gameData.currentEnemyIndex]};
            updateBattleUI();
            showScreen(battleScreen);
            addBattleLog(`ä½ é‡åˆ°äº†${gameData.enemy.name}ï¼`);
        }

        // æ›´æ–°æˆ˜æ–—UI
        function updateBattleUI() {
            // ç©å®¶ä¿¡æ¯
            playerNameElement.textContent = gameData.player.name;
            playerAvatarElement.textContent = gameData.player.avatar;
            playerLevelElement.textContent = `Lv. ${gameData.player.level}`;
            updateHealthBar(playerHealthElement, gameData.player.health, gameData.player.maxHealth);
            updateChakraBar(playerChakraElement, gameData.player.chakra, gameData.player.maxChakra);
            
            // æ•Œäººä¿¡æ¯
            enemyNameElement.textContent = gameData.enemy.name;
            enemyAvatarElement.textContent = gameData.enemy.avatar;
            enemyLevelElement.textContent = `Lv. ${gameData.enemy.level}`;
            updateHealthBar(enemyHealthElement, gameData.enemy.health, gameData.enemy.maxHealth);
            updateChakraBar(enemyChakraElement, gameData.enemy.chakra, gameData.enemy.maxChakra);
            
            // æ›´æ–°æŠ€èƒ½ä¿¡æ¯
            jutsu1NameElement.textContent = gameData.player.jutsu1.name;
            jutsu1CostElement.textContent = `æ¶ˆè€—: ${gameData.player.jutsu1.cost} æŸ¥å…‹æ‹‰`;
            jutsu2NameElement.textContent = gameData.player.jutsu2.name;
            jutsu2CostElement.textContent = `æ¶ˆè€—: ${gameData.player.jutsu2.cost} æŸ¥å…‹æ‹‰`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateActionButtons();
        }

        // æ›´æ–°ç”Ÿå‘½æ¡
        function updateHealthBar(barElement, current, max) {
            const percentage = (current / max) * 100;
            barElement.style.width = `${percentage}%`;
        }

        // æ›´æ–°æŸ¥å…‹æ‹‰æ¡
        function updateChakraBar(barElement, current, max) {
            const percentage = (current / max) * 100;
            barElement.style.width = `${percentage}%`;
        }

        // æ›´æ–°åŠ¨ä½œæŒ‰é’®çŠ¶æ€
        function updateActionButtons() {
            actionButtons.forEach(btn => {
                const action = btn.dataset.action;
                
                if (action === 'attack') {
                    // ä½“æœ¯æ”»å‡»ä¸éœ€è¦æŸ¥å…‹æ‹‰
                    btn.disabled = false;
                } else if (action === 'jutsu1') {
                    btn.disabled = gameData.player.chakra < gameData.player.jutsu1.cost;
                } else if (action === 'jutsu2') {
                    btn.disabled = gameData.player.chakra < gameData.player.jutsu2.cost;
                } else if (action === 'heal') {
                    btn.disabled = gameData.player.chakra < 25 || gameData.player.health >= gameData.player.maxHealth;
                }
            });
        }

        // æ‰§è¡Œç©å®¶åŠ¨ä½œ
        function performPlayerAction(action) {
            // é‡ç½®ç‰¹æ®Šæ•ˆæœ
            gameData.dodgeNextAttack = false;
            gameData.criticalNextAttack = false;
            
            let damage = 0;
            let logMessage = "";
            
            switch(action) {
                case 'attack':
                    damage = Math.floor(Math.random() * 10) + 10;
                    if (gameData.criticalNextAttack) {
                        damage *= 2;
                        logMessage = `å†™è½®çœ¼æ•ˆæœè§¦å‘ï¼${gameData.player.name}çš„ä½“æœ¯æ”»å‡»é€ æˆåŒå€ä¼¤å®³ï¼`;
                    }
                    damageEnemy(damage);
                    addBattleLog(`${gameData.player.name}ä½¿ç”¨ä½“æœ¯æ”»å‡»ï¼Œå¯¹${gameData.enemy.name}é€ æˆ${damage}ç‚¹ä¼¤å®³ï¼`);
                    if (logMessage) addBattleLog(logMessage);
                    playerAvatarElement.classList.add('attack-animation');
                    break;
                    
                case 'jutsu1':
                    const jutsu1 = gameData.player.jutsu1;
                    gameData.player.chakra -= jutsu1.cost;
                    damage = jutsu1.damage + Math.floor(Math.random() * 10);
                    damageEnemy(damage);
                    
                    // åˆ›å»ºå¿æœ¯ç‰¹æ•ˆ
                    const jutsuElement = document.createElement('div');
                    jutsuElement.className = 'jutsu-animation';
                    jutsuElement.textContent = gameData.player.avatar;
                    jutsuElement.style.left = '50%';
                    jutsuElement.style.top = '50%';
                    document.querySelector('.battle-area').appendChild(jutsuElement);
                    
                    addBattleLog(`${gameData.player.name}ä½¿ç”¨${jutsu1.name}ï¼Œå¯¹${gameData.enemy.name}é€ æˆ${damage}ç‚¹ä¼¤å®³ï¼`);
                    playerAvatarElement.classList.add('attack-animation');
                    break;
                    
                case 'jutsu2':
                    const jutsu2 = gameData.player.jutsu2;
                    gameData.player.chakra -= jutsu2.cost;
                    
                    if (jutsu2.effect === 'dodge') {
                        gameData.dodgeNextAttack = true;
                        addBattleLog(`${gameData.player.name}ä½¿ç”¨${jutsu2.name}ï¼Œä¸‹æ¬¡æ”»å‡»å°†ä¼šé—ªé¿ï¼`);
                    } else if (jutsu2.effect === 'critical') {
                        gameData.criticalNextAttack = true;
                        addBattleLog(`${gameData.player.name}ä½¿ç”¨${jutsu2.name}ï¼Œä¸‹æ¬¡æ”»å‡»å°†ä¼šé€ æˆåŒå€ä¼¤å®³ï¼`);
                    } else if (jutsu2.effect === 'heal') {
                        const healAmount = 30;
                        gameData.player.health = Math.min(gameData.player.health + healAmount, gameData.player.maxHealth);
                        addBattleLog(`${gameData.player.name}ä½¿ç”¨${jutsu2.name}ï¼Œæ¢å¤äº†${healAmount}ç‚¹ç”Ÿå‘½å€¼ï¼`);
                    }
                    break;
                    
                case 'heal':
                    gameData.player.chakra -= 25;
                    const healAmount = 40;
                    gameData.player.health = Math.min(gameData.player.health + healAmount, gameData.player.maxHealth);
                    addBattleLog(`${gameData.player.name}ä½¿ç”¨åŒ»ç–—å¿æœ¯ï¼Œæ¢å¤äº†${healAmount}ç‚¹ç”Ÿå‘½å€¼ï¼`);
                    break;
            }
            
            // æ›´æ–°UI
            updateBattleUI();
            
            // ç§»é™¤åŠ¨ç”»ç±»
            setTimeout(() => {
                playerAvatarElement.classList.remove('attack-animation');
                const jutsuElements = document.querySelectorAll('.jutsu-animation');
                jutsuElements.forEach(el => el.remove());
            }, 500);
            
            // æ£€æŸ¥æ•Œäººæ˜¯å¦è¢«å‡»è´¥
            if (gameData.enemy.health <= 0) {
                enemyDefeated();
                return;
            }
            
            // æ•Œäººè¡ŒåŠ¨
            setTimeout(enemyAction, 1000);
        }

        // æ•Œäººè¡ŒåŠ¨
        function enemyAction() {
            // å¦‚æœç©å®¶æœ‰é—ªé¿æ•ˆæœï¼Œæ•Œäººæ”»å‡»å¤±è´¥
            if (gameData.dodgeNextAttack) {
                addBattleLog(`${gameData.player.name}æˆåŠŸé—ªé¿äº†${gameData.enemy.name}çš„æ”»å‡»ï¼`);
                updateBattleUI();
                return;
            }
            
            const damage = gameData.enemy.damage + Math.floor(Math.random() * 5);
            gameData.player.health -= damage;
            gameData.player.health = Math.max(0, gameData.player.health);
            
            addBattleLog(`${gameData.enemy.name}æ”»å‡»${gameData.player.name}ï¼Œé€ æˆ${damage}ç‚¹ä¼¤å®³ï¼`);
            playerAvatarElement.classList.add('damage-animation');
            enemyAvatarElement.classList.add('enemy-attack-animation');
            
            // æ›´æ–°UI
            updateBattleUI();
            
            // ç§»é™¤åŠ¨ç”»ç±»
            setTimeout(() => {
                playerAvatarElement.classList.remove('damage-animation');
                enemyAvatarElement.classList.remove('enemy-attack-animation');
            }, 500);
            
            // æ£€æŸ¥ç©å®¶æ˜¯å¦è¢«å‡»è´¥
            if (gameData.player.health <= 0) {
                playerDefeated();
            }
        }

        // å¯¹æ•Œäººé€ æˆä¼¤å®³
        function damageEnemy(damage) {
            gameData.enemy.health -= damage;
            gameData.enemy.health = Math.max(0, gameData.enemy.health);
            enemyAvatarElement.classList.add('damage-animation');
            
            setTimeout(() => {
                enemyAvatarElement.classList.remove('damage-animation');
            }, 500);
        }

        // æ•Œäººè¢«å‡»è´¥
        function enemyDefeated() {
            addBattleLog(`ä½ å‡»è´¥äº†${gameData.enemy.name}ï¼`);
            
            // ç©å®¶å‡çº§
            gameData.player.level++;
            gameData.player.maxHealth += 10;
            gameData.player.health = gameData.player.maxHealth;
            gameData.player.maxChakra += 5;
            gameData.player.chakra = gameData.player.maxChakra;
            
            addBattleLog(`${gameData.player.name}å‡çº§äº†ï¼æœ€å¤§ç”Ÿå‘½å€¼+10ï¼Œæœ€å¤§æŸ¥å…‹æ‹‰+5ï¼`);
            
            // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•Œäººæˆ–ç»“æŸæ¸¸æˆ
            gameData.currentEnemyIndex++;
            
            if (gameData.currentEnemyIndex >= gameData.enemies.length) {
                // æ¸¸æˆèƒœåˆ©
                setTimeout(() => {
                    endTitleElement.textContent = "æ­å–œï¼";
                    endMessageElement.textContent = "ä½ å·²ç»å‡»è´¥äº†æ‰€æœ‰æ•Œäººï¼Œæˆä¸ºäº†ç«å½±ï¼";
                    showScreen(endScreen);
                }, 1500);
            } else {
                // ä¸‹ä¸€ä¸ªæ•Œäºº
                setTimeout(() => {
                    startBattle();
                }, 1500);
            }
        }

        // ç©å®¶è¢«å‡»è´¥
        function playerDefeated() {
            addBattleLog(`ä½ è¢«${gameData.enemy.name}å‡»è´¥äº†ï¼`);
            
            setTimeout(() => {
                endTitleElement.textContent = "æ¸¸æˆç»“æŸ";
                endMessageElement.textContent = "ä½ çš„å¿è€…ä¹‹è·¯åˆ°æ­¤ä¸ºæ­¢ï¼Œè¯·å†æ¥å†å‰ï¼";
                showScreen(endScreen);
            }, 1500);
        }

        // æ·»åŠ æˆ˜æ–—æ—¥å¿—
        function addBattleLog(message) {
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            battleLogElement.appendChild(logEntry);
            battleLogElement.scrollTop = battleLogElement.scrollHeight;
        }

        // æ˜¾ç¤ºå±å¹•
        function showScreen(screen) {
            startScreen.classList.remove('active');
            battleScreen.classList.remove('active');
            endScreen.classList.remove('active');
            screen.classList.add('active');
            
            if (screen === battleScreen) {
                battleLogElement.innerHTML = '<div>æˆ˜æ–—å¼€å§‹ï¼</div>';
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
  </html>
